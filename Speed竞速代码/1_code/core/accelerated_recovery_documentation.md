# 加速找回功能详细说明

## 功能概述

新增了基于最后检测状态的加速找回策略，当机器人冲过弯道丢失蓝线时，能够智能地按照最后一次检测到的方向和速度进行加速找回。

## 实现的核心机制

### 1. 状态记录增强
```python
# 新增状态变量
self.last_z_speed: float = 0.0  # 记录最后一次转向速度
self.last_x_speed: float = 0.0  # 记录最后一次前进速度

# 在检测到线条时更新状态
self.last_z_speed = float(z_speed)
self.last_x_speed = float(x_speed)
```

### 2. 智能加速找回算法

**急弯冲出去的情况**：
```python
if self.last_curve_direction != "straight":
    if self.last_curve_direction == "left":
        # 左转冲出去：加速左转 + 适当前进
        z_speed = self.last_z_speed * 1.5  # 加速转向
        x_speed = min(0.8, self.last_x_speed * 1.2)  # 适当加速前进
        search_status = f"加速左转找回"
    else:  # right
        # 右转冲出去：加速右转 + 适当前进
        z_speed = self.last_z_speed * 1.5  # 加速转向
        x_speed = min(0.8, self.last_x_speed * 1.2)  # 适当加速前进
        search_status = f"加速右转找回"
```

**直线冲出去的情况**：
```python
else:
    # 直线冲出去的情况：常规搜索
    search_speed = self.config.search_speed_degrees * self.search_direction
    z_speed = search_speed
    x_speed = 0.2  # 保持轻微前进
    search_status = "常规搜索"
```

## 工作流程

### 正常巡线阶段
1. 检测蓝线并计算曲率和方向
2. 根据弯道类型选择相应的PID控制器
3. 记录当前的控制指令（转向速度和前进速度）
4. 记录当前的弯道方向

### 丢线恢复阶段
1. **判断冲出去的类型**：
   - 如果是急弯冲出去（last_curve_direction != "straight"）
   - 如果是直线冲出去（last_curve_direction == "straight"）

2. **执行相应的找回策略**：
   - **急弯找回**：加速1.5倍转向 + 加速1.2倍前进
   - **直线找回**：常规搜索转向 + 轻微前进

3. **安全限制**：
   - 前进速度上限0.8m/s防止失控
   - 保持转向力度但避免过度转向

## 性能优势

### 1. 响应速度提升
- 急弯冲出去时，转向响应速度提升50%
- 前进速度适当提升20%，加快找回效率

### 2. 智能方向判断
- 基于最后一次检测的弯道方向进行精准找回
- 左转冲出去就加速左转找回，右转冲出去就加速右转找回

### 3. 安全性保障
- 前进速度有上限限制（0.8m/s）
- 转向加速但不过度，避免原地打转

## 调试信息显示

在调试界面可以看到：
- **搜索状态**：显示"加速左转找回"或"加速右转找回"
- **最后方向**：显示最后一次检测到的弯道方向
- **倒计时**：显示搜索剩余时间

## 参数调优建议

### 加速系数调整
```python
# 如果需要更激进的找回，可以调整这些系数：
z_speed = self.last_z_speed * 1.8  # 更激进的转向加速
x_speed = min(1.0, self.last_x_speed * 1.5)  # 更激进的前进加速
```

### 安全限制调整
```python
# 如果需要调整安全上限：
x_speed = min(1.2, self.last_x_speed * 1.2)  # 提高前进速度上限
```

## 适用场景

### 最佳适用情况
1. **急弯冲过线**：机器人在急弯处因速度过快冲过蓝线
2. **直角弯丢失**：在直角弯处转向不足导致丢失蓝线
3. **复杂弯道**：连续弯道中暂时丢失视线但知道大致方向

### 注意事项
1. **直线行驶**：直线冲出去时仍使用常规搜索策略
2. **长时间丢失**：超过超时时间后会改变搜索方向
3. **安全第一**：加速找回时仍有速度上限保护

## 测试验证

### 测试方法
1. 故意让机器人在急弯处冲过蓝线
2. 观察是否能够快速加速找回
3. 检查转向方向是否正确
4. 验证速度限制是否有效

### 预期效果
- 急弯冲出去后应在2-3秒内找回蓝线
- 找回方向应与冲出去的方向一致
- 速度应控制在安全范围内

这个加速找回功能大大提升了机器人在复杂弯道中的恢复能力，特别是在竞速场景中能够显著减少丢线时间。
